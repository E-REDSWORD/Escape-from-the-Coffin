<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>الهروب من التابوت | RedSword</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?
  family=Tajawal:wght@800;900&family=Amiri&family=Lateef&
  family=Almarai:wght@800&display=swap" rel="stylesheet">
  <style>
    /* إضافة أنماط لصفحة البداية */
    #start-page {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('category.png') no-repeat center center;
      background-size: cover;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      transition: opacity 0.5s ease;
    }
    
    .start-content {
      background: rgba(0, 0, 0, 0.7);
      border: 3px solid var(--redsword-red);
      border-radius: 20px;
      padding: 40px;
      max-width: 700px;
      width: 90%;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.8);
    }
    
    .start-title {
      font-family: 'Almarai', sans-serif;
      font-size: 3.5rem;
      color: #f1c40f;
      margin-bottom: 30px;
      text-shadow: 0 0 15px rgba(196, 30, 30, 0.7);
    }
    
    .version-buttons {
      display: flex;
      flex-direction: column;
      gap: 25px;
      margin-top: 40px;
    }
    
    .version-btn {
      background: linear-gradient(145deg, #c41e1e, #8a1515);
      color: white;
      border: none;
      padding: 20px;
      border-radius: 15px;
      font-size: 1.8rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
    }
    
    .version-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 25px rgba(0, 0, 0, 0.8);
      background: linear-gradient(145deg, #d92323, #9a1717);
    }
    
    .version-btn:active {
      transform: translateY(0);
    }
    
    .version-btn i {
      font-size: 2.2rem;
    }
    
    .start-description {
      font-family: 'Amiri', serif;
      font-size: 1.4rem;
      line-height: 1.8;
      color: #f5f5f5;
      margin: 20px 0;
    }
    
    /* أنماط الزر الجديد */
    .copy-btn {
      background: linear-gradient(145deg, #1e3ac4, #151d8a);
      color: white;
      border: none;
      padding: 15px 25px;
      border-radius: 10px;
      font-size: 1.2rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin: 20px auto;
    }
    
    .copy-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.8);
      background: linear-gradient(145deg, #233ad9, #171d9a);
    }
    
    .copy-btn:active {
      transform: translateY(0);
    }
    
    .copy-btn i {
      font-size: 1.3rem;
    }
    
    /* رسالة التأكيد */
    #copy-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(30, 167, 86, 0.9);
      color: white;
      padding: 15px 25px;
      border-radius: 8px;
      font-size: 1.1rem;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
      z-index: 3000;
      transform: translateX(150%);
      transition: transform 0.4s ease;
    }
    
    #copy-notification.show {
      transform: translateX(0);
    }
    
    /* بقية الأنماط كما هي */
  	.banner2-img {
      width: 100%;
      max-width: 1500px;
      height: 70px;
      display: block;
      margin: 0 auto;
    }
    /* ---------- متغيرات التصميم ---------- */
    :root {
      --redsword-red: #c41e1e;
      --redsword-dark: #1a1a1a;
      --coffin-brown: #4e1f07;
      --coffin-light: #9c4a1a;
      --gold: #f1c40f;
      --text-light: #f5f5f5;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    }
    
    /* ---------- التصميم العام ---------- */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      background: linear-gradient(135deg, #1a1a1a, #2a0c0c, #1a1a1a);
      background: url('ghal.png') no-repeat center center;
      background-size: cover;
      
      background-size: 200% 200%;
      animation: gradientBG 15s ease infinite;
      font-family: 'Cairo', 'Segoe UI', Tahoma, sans-serif;
      color: var(--text-light);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow-x: hidden;
    }
    
    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    /* ---------- الرأس والتذييل ---------- */
   /* ---------- الرأس والتذييل بشفافية عالية ---------- */
header {
  font-family: 'Tajawal', sans-serif;
  padding: 20px;
  background: rgba(0, 0, 0, 0);       /* شفافية كاملة */
  border-bottom: 2px solid rgba(255, 111, 97, 0.9); /* لون دموي باهت قليلاً */
  text-align: center;
}

/* شعار اللعبة بخط مزخرف وحدود واضحة */
.logo {
  font-family: 'Almarai', sans-serif;
  font-size: 4rem;
  color: #ffffff;                     /* أبيض بارز */
  -webkit-text-stroke: 2px #ff6f61;   /* حد خارجي بلون دموي */
  text-shadow:
    0 0 8px #ff6f61,
    0 0 12px #ff6f61,
    2px 2px 4px rgba(0, 0, 0, 0.7);
  animation: glow 2s ease-in-out infinite alternate;
}

/* أيقونة السيف تبقى ذهبية مع ضلال خفيفة */
.logo-container .fas.fa-swords {
  font-size: 2.5rem;
  color: #f1c40f;
  text-shadow:
    0 0 5px #f1c40f,
    0 0 10px #f1c40f;
}

@keyframes glow {
  from {
    text-shadow:
      0 0 5px #ffffff,
      0 0 10px #ff6f61;
  }
  to {
    text-shadow:
      0 0 15px #ffffff,
      0 0 25px #ff6f61;
  }
}

/* ---------- العنوان الرئيسي بخلفية شفافة وحدود واضحة ---------- */
h1 {
  font-family: 'Tajawal', sans-serif;
  font-weight: 900;
  font-size: 3rem;
  background: rgba(0, 0, 0, 0);       /* شفافية كاملة */
  color: #ffffff;                     /* أبيض بارز */
  -webkit-text-stroke: 1.5px #ff6f61; /* حد دموي */
  text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.7);
  margin: 20px 0;
  text-align: center;
}

/* ---------- العناوين الفرعية بخط مزخرف وحدود ---------- */
h2 {
  font-family: 'Lateef', cursive;
  font-size: 2rem;
  background: transparent;
  color: #ff6f61;                     /* دموي بارز */
  -webkit-text-stroke: 1px #ffffff;   /* حد أبيض */
  text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
  margin: 15px 0;
  text-align: center;
}

/* ---------- النص الوصفي بخلفية شفافة وحدود --------- */
.subtitle {
  font-family: 'Amiri', serif;
  font-size: 1.2rem;
  line-height: 1.6;
  background: transparent;
  color: #ffffff;                     /* أبيض بارز */
  -webkit-text-stroke: 0.8px #ff6f61; /* حد دموي خفيف */
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.6);
  max-width: 700px;
  margin: 20px auto;
  text-align: center;
}

/* ---------- التذييل بخلفية شفافة ونص بارز ---------- */
footer {
  font-family: 'Lateef', cursive;
  background: transparent;
  color: #dddddd;
  padding: 20px;
  text-align: center;
  border-top: 2px solid rgba(255, 111, 97, 0.6);
  width: 100%;
  max-width: 1000px;
  margin: 0 auto;
}

footer .redsword-link {
  font-family: 'Tajawal', sans-serif;
  font-weight: 800;
  color: #ffffff;
  -webkit-text-stroke: 1px #ff6f61;
  text-decoration: none;
  transition: color 0.3s;
}

footer .redsword-link:hover {
  color: #ff6f61;
}
    
    .redsword-link {
      color: var(--redsword-red);
      text-decoration: none;
      font-weight: bold;
    }
    
    /* ---------- شبكة التوابيت ---------- */
    .grid-container {
      display: grid;
      /* تم التعديل: عرض 4 توابيت في كل سطر على جميع الأجهزة */
      grid-template-columns: repeat(4, 1fr); 
      gap: 20px;
      width: 100%;
      max-width: 1000px;
      margin: 0 auto;
    }
    
    /* تم إزالة استعلامات الوسائط التي تغير عدد الأعمدة لضمان 4 أعمدة دائمًا */
    /* تصميم متجاوب للخطوط والعناصر الأخرى لا يزال ساريًا */
    @media (max-width: 600px) {
      h1 {
        font-size: 2rem;
      }
      
      .logo {
        font-size: 1.8rem;
      }
      
      .version-btn {
        font-size: 1.4rem;
        padding: 15px;
      }
      
      .start-title {
        font-size: 2.5rem;
      }
      
      .copy-btn {
        font-size: 1rem;
        padding: 12px 20px;
      }
    }
    
    @media (max-width: 400px) {
      body {
        padding: 10px;
      }
      
      .start-content {
        padding: 20px;
      }
      
      .version-btn {
        font-size: 1.2rem;
      }
      
      .start-title {
        font-size: 2rem;
      }
      
      .copy-btn {
        font-size: 0.9rem;
        padding: 10px 15px;
      }
    }
    
    .coffin-button {
      position: relative;
      width: 100%;
      aspect-ratio: 0.5;
      background: linear-gradient(145deg, var(--coffin-light) 0%, var(--coffin-brown) 100%);
      clip-path: polygon(35% 0%, 65% 0%, 100% 20%, 85% 100%, 15% 100%, 0% 20%);
      border: 3px solid #2b1a0e;
      box-shadow:
        inset 0 0 15px rgba(0, 0, 0, 0.4),
        0 6px 15px rgba(0, 0, 0, 0.8);
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      overflow: hidden;
      display: flex; /* لتوسيط المحتوى الجديد */
      justify-content: center;
      align-items: center;
    }
    
    .coffin-button:hover {
      transform: translateY(-5px) scale(1.03);
      box-shadow: 
        inset 0 0 15px rgba(0, 0, 0, 0.4),
        0 10px 20px rgba(0, 0, 0, 0.9);
    }
    
    .coffin-button:active {
      transform: translateY(0) scale(0.98);
    }
    
    .coffin-button[disabled] {
      opacity: 0.8; /* جعل التابوت المعطل أكثر وضوحًا */
      cursor: default;
      transform: none !important;
      box-shadow: 
        inset 0 0 15px rgba(0, 0, 0, 0.4),
        0 3px 8px rgba(0, 0, 0, 0.6) !important;
    }

    /* تصميم التابوت بعد الكشف عن محتواه */
    .coffin-button.coffin-revealed {
        background: linear-gradient(145deg, #3a1705 0%, #2e1201 100%); /* مظهر أغمق "مفتوح" */
        box-shadow:
            inset 0 0 10px rgba(0, 0, 0, 0.6),
            0 3px 8px rgba(0, 0, 0, 0.6) !important;
    }
    
    .coffin-button::after {
      content: "";
      position: absolute;
      top: 11%;
      left: 9%;
      width: 82%;
      height: 78%;
      clip-path: inherit;
      border: 2px solid #000;
      box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.6);
      pointer-events: none;
    }
    
    .coffin-lines {
      position: absolute;
      top: 0; 
      left: 0;
      width: 100%; 
      height: 100%;
      pointer-events: none;
    }
    
    .coffin-lines line {
      stroke: #000; 
      stroke-width: 1.8;
    }
    
    .coffin-text {
      position: absolute;
      top: 12%;
      left: 50%;
      transform: translateX(-50%);
      color: var(--gold);
      font-size: 1rem;
      text-align: center;
      line-height: 1.4;
      white-space: pre-line;
      pointer-events: none;
      text-shadow:
        1px 1px 2px rgba(0, 0, 0, 0.8),
        -1px -1px 2px rgba(0, 0, 0, 0.5);
      font-weight: bold;
      width: 90%;
    }
    
    /* تعديل حجم الخط للشاشات الصغيرة */
    @media (max-width: 600px) {
      .coffin-text {
        font-size: 0.85rem;
        line-height: 1.3;
      }
    }
    
    /* ---------- التابوت المفتوح (مودال) ---------- */
    #modal {
      position: fixed;
      top: 0; 
      left: 0;
      width: 100%; 
      height: 100%;
      background: rgba(0, 0, 0, 0.45); /* خلفية شفافة داكنة */
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease;
    }
    
    #modal.active {
      opacity: 1;
      pointer-events: all;
    }
    
    .open-coffin {
      position: relative;
      width: 480px;
      max-width: 90vw;
      aspect-ratio: 0.5;
      clip-path: polygon(35% 0%, 65% 0%, 100% 20%, 85% 100%, 15% 100%, 0% 20%);
      background: linear-gradient(145deg, #4d0000, #200000);
      border: 3px solid #222;
      box-shadow:
        10px 10px 40px rgba(0, 0, 0, 0.4),
        inset 0 -25px 35px rgba(0, 0, 0, 0.5),
        inset 0 20px 20px rgba(255, 255, 255, 0.05);
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      /* تم التعديل: تصغير حجم التابوت المفتوح بنسبة 40% (يصبح 60% من الحجم الأصلي) */
      transform: scale(0.6); 
      transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    #modal.active .open-coffin {
      /* يبقى الحجم مصغراً عند التفعيل */
      transform: scale(0.6);
    }
    
    .open-coffin .lid {
      position: absolute;
      top: -105px; 
      left: -75px;
      width: 570px; 
      height: 270px;
      clip-path: polygon(10% 0%, 90% 0%, 100% 80%, 0% 80%);
      background: linear-gradient(to bottom, #600000, #200000);
      border: 2px solid #111;
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.5);
      transform: rotateX(50deg) rotateZ(-10deg);
      z-index: 2;
      transition: transform 1s ease;
    }
    
    #modal.active .open-coffin .lid {
      transform: rotateX(70deg) rotateZ(-10deg) translateY(-30px);
    }
    
    .open-coffin .inner {
      position: absolute;
      top: 12%; 
      left: 10%;
      width: 80%; 
      height: 80%;
      background-color: #500;
      background-image:
        radial-gradient(circle at 20px 20px, #700 15%, transparent 16%),
        radial-gradient(circle at 60px 60px, #700 15%, transparent 16%);
      background-size: 40px 40px;
      border: 2px solid #111;
      box-shadow:
        inset 0 0 25px rgba(0, 0, 0, 0.8),
        inset 0 0 10px rgba(255, 255, 255, 0.1);
      clip-path: inherit;
      z-index: 1;
    }
    
    .open-coffin .coffin-msg {
      position: absolute;
      top: 15%;
      left: 50%;
      transform: translateX(-50%);
      color: gold;
      text-align: center;
      white-space: pre-line;
      /* تم التعديل: تصغير حجم الخط بنسبة 40% */
      font-size: 2.3rem; /* 2.2rem * 0.6 = 1.32rem */
      text-shadow: 1px 1px 3px #000, 0 0 20px rgba(196, 30, 30, 0.7);
      z-index: 3;
      width: 90%;
      line-height: 1.4;
      font-weight: bold;
    }
    
    .open-coffin .coffin-emoji {
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translateX(-50%);
      /* تم التعديل: تصغير حجم الإيموجي بنسبة 40% */
      font-size: 7.8rem; /* 8rem * 0.6 = 4.8rem */
      z-index: 3;
      line-height: 0.7;
      text-shadow: 0 0 15px rgba(0, 0, 0, 0.8);
      animation: float 2s ease-in-out infinite;
    }
    
    @keyframes float {
      0% { transform: translateX(-50%) translateY(0px); }
      50% { transform: translateX(-50%) translateY(-15px); }
      100% { transform: translateX(-50%) translateY(0px); }
    }
    
    .close-btn {
      position: absolute;
      top: 150px;
      right: 20px;
      background: url('exte.png') no-repeat center center;
      background-size: cover;
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: var(--shadow);
      z-index: 1001;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* رسوم متحركة للخلفية */
    .bg-elements {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
      overflow: hidden;
    }
    
    .bat {
      position: absolute;
      color: red;
      font-size: 2rem;
      animation: fly linear infinite;
      opacity: 0.4;
    }
    
    @keyframes fly {
      0% {
        transform: translateX(-100px) translateY(var(--y));
      }
      100% {
        transform: translateX(calc(100vw + 100px)) translateY(var(--y));
      }
    }

    /* ---------- زر كيفية اللعب ---------- */
    .game-button {
      background-color: var(--gold);
      color: var(--redsword-dark);
      border: 2px solid var(--gold);
      padding: 12px 25px;
      border-radius: 10px;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: var(--shadow);
      margin-top: 20px; /* إضافة مسافة من الأعلى */
      margin-bottom: 30px; /* إضافة مسافة من الأسفل */
    }
    .game-button:hover {
      background-color: #f3d95a;
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.6);
    }
    .game-button:active {
      transform: translateY(0);
    }

    /* ---------- شاشة شرح اللعبة (مودال المساعدة) ---------- */
    #help-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85); /* خلفية شفافة داكنة */
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1002; /* أعلى من مودال التابوت */
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease;
    }
    #help-modal.active {
      opacity: 1;
      pointer-events: all;
    }
    .help-content {
      background: linear-gradient(145deg, #2a0c0c, #1a1a1a); /* خلفية داكنة */
      border: 3px solid var(--redsword-red);
      border-radius: 15px;
      padding: 30px;
      margin: 20px;
      max-width: 600px;
      width: 90%;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
      text-align: right; /* محاذاة النص لليمين للغة العربية */
      color: var(--text-light);
      position: relative;
      max-height: 80vh; /* تحديد أقصى ارتفاع */
      overflow-y: auto; /* إضافة شريط تمرير إذا تجاوز المحتوى الارتفاع */
    }
    .help-content h2 {
      color: var(--gold);
      font-size: 2rem;
      margin-bottom: 20px;
      text-align: center;
      text-shadow: 0 0 10px rgba(241, 196, 15, 0.5);
    }
    .help-content p {
      margin-bottom: 15px;
      line-height: 1.6;
      font-size: 1.1rem;
    }
    .help-content ul {
      list-style: none;
      padding: 0;
      margin-bottom: 20px;
    }
    .help-content ul li {
      margin-bottom: 10px;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .help-content ul li .emoji {
        font-size: 1.5rem;
    }
    .close-help-btn {
      background-color: var(--redsword-red);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.3s ease;
      display: block; /* جعل الزر يأخذ عرض كامل السطر */
      margin: 20px auto 0 auto; /* توسيط الزر أسفل المحتوى */
      box-shadow: var(--shadow);
    }
    .close-help-btn:hover {
      background-color: #a01515;
      transform: translateY(-2px);
    }

    /* ---------- تصميم المحتوى المكشوف داخل التابوت في الشبكة ---------- */
    .coffin-button .revealed-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      text-align: center;
      color: var(--text-light);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      pointer-events: none; /* لضمان عدم التفاعل مع هذا المحتوى */
    }

    .coffin-button .revealed-emoji {
      font-size: 3rem; /* حجم الإيموجي داخل التابوت المكشوف */
      line-height: 0.7;
      margin-bottom: 10px;
      text-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
    }

    .coffin-button .revealed-text {
      font-size: 0.9rem; /* حجم النص داخل التابوت المكشوف */
      line-height: 0.95;
      font-weight: bold;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
    }

    /* تعديلات حجم الخط للشاشات الصغيرة للمحتوى المكشوف */
    @media (max-width: 600px) {
      .coffin-button .revealed-emoji {
        font-size: 1.7rem;
      }
      .coffin-button .revealed-text {
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <!-- صفحة البداية -->
  <div id="start-page">
    <div class="start-content">
      <h1 class="start-title">الهروب من التابوت</h1>
      <p class="start-description">
        اختر نسخة اللعبة التي ترغب في لعبها. كل نسخة تحتوي على عدد مختلف من التوابيت وتوزيع مختلف للمحتويات. 
        توابيت أكثر تعني تحدياً أكبر ومزيداً من التشويق!
      </p>
      
      <div class="version-buttons">
        <button class="version-btn" onclick="startGame(16)">
          <i class="fas fa-coffin"></i> نسخة 16 تابوت
        </button>
        <button class="version-btn" onclick="startGame(20)">
          <i class="fas fa-skull"></i> نسخة 20 تابوت
        </button>
      </div>
    </div>
  </div>
  
  <!-- إشعار النسخ -->
  <div id="copy-notification">
    <i class="fas fa-check-circle"></i> تم نسخ التوابيت المتبقية إلى الحافظة!
  </div>
	
  <!-- رأس الصفحة -->
  <header>
  	
    <div class="logo-container">
      <i class="fas fa-swords logo"></i>
      <span class="logo">ألعاب 𖤍RedSword</span>
    </div>
    <h1>الهروب من التابوت</h1>
    <p class="subtitle"></p>
  </header>
  
  <!-- عناصر الخلفية المتحركة -->
  <div class="bg-elements" id="bgElements"></div>
  
  <!-- شعار الموقع -->
  <img src="logo.png" alt="صورة رأس الموقع" class="banner2-img">

  <!-- زر كيفية اللعب -->
  <button id="showHelpBtn" class="game-button">كيفية اللعب؟</button>

  <!-- شبكة التوابيت -->
  <div class="grid-container" id="grid"></div>
  
  <!-- زر نسخ التوابيت المتبقية -->
  <button id="copyRemainingBtn" class="copy-btn">
    <i class="fas fa-copy"></i> نسخ التوابيت المتبقية
  </button>
  
  <!-- التابوت المفتوح (مودال) -->
  <div id="modal">
    <button class="close-btn">&times;</button> <!-- تم إزالة onclick هنا -->
    <div class="open-coffin">
      <div class="lid"></div>
      <div class="inner"></div>
      <div class="coffin-msg"></div>
      <div class="coffin-emoji"></div>
    </div>
  </div>

  <!-- شاشة شرح اللعبة (مودال المساعدة) -->
  <div id="help-modal">
    <div class="help-content">
        <h2>كيفية اللعب؟</h2>
        <p>مرحباً بك في <strong>"الهروب من التابوت"</strong>! هدفك هو النقر على التوابيت للكشف عن محتواها ومواجهة مصيرك.</p>
        <ul>
            <li><span class="emoji">⚰️📥</span> <strong>تابوت فارغ:</strong> لا شيء هنا.</li>
            <li><span class="emoji">🧱🧟</span> <strong>تابوت ممتلئ:</strong> واصل البحث، لا شيء هنا.</li>
            <li><span class="emoji">💀🧹📤</span> <strong>مقشة الساحرة:</strong> تحرر زميل لك من الحبس.</li>
            <li><span class="emoji">🦇🌕</span> <strong>سرب خفافيش:</strong> يحبس زميل لك.</li>
            <li><span class="emoji">👻</span> <strong>شبح مرعب:</strong> للأسف، لقد قتلت!</li>
        </ul>
        <p>اختر بحكمة وحاول البقاء على قيد الحياة! كل نقرة هي خطوة نحو مصيرك.</p>
        <button class="close-help-btn" onclick="hideHelpModal()">إغلاق</button>
    </div>
  </div>
  
  <!-- تذييل الصفحة -->
  <footer>
    <p>لعبة <strong>"الهروب من التابوت"</strong> مقدمة من موقع 
      <a href="https://redsword.com" class="redsword-link" target="_blank">RedSword للألعاب</a>
    </p>
    <p>جميع الحقوق محفوظة &copy; 2025</p>
  </footer>

  <script>
    // دالة لبدء اللعبة حسب النسخة المختارة
    function startGame(version) {
      // إخفاء صفحة البداية
      document.getElementById('start-page').style.display = 'none';
      
      // تحديد بيانات اللعبة حسب النسخة المختارة
      let names, allOutcomes;
      
      if (version === 16) {
        // بيانات اللعبة لنسخة 16 تابوت
        names = [
          "صرخات الليل", "مقبرة الجن", "عذاب الارواح", "افعى القبور",
          "حطب جهنم", "عظام الجن", "زئير الهلاك", "صرير الكفن",
          "دم الخفافيش", "العنة الأبدية", "لعنة الحياة", "الافاعي المسكونة",
          "رأس الغراب", "صرخة الاموات", "نفس الجلاد", "همسة الجحيم"
        ];
        
        // تعريف جميع النتائج الممكنة مع توزيعها للنسخة 16
        allOutcomes = [];
        // 7 توابيت فارغة
        for (let i = 0; i < 7; i++) allOutcomes.push({ text: 'تابوت فارغ\nاحبس عدوك', emoji: '⚰️📥' });
        // 3 توابيت ممتلئة
        for (let i = 0; i < 3; i++) allOutcomes.push({ text: 'تابوت ممتلئ\nواصل البحث', emoji: '🧱🧟' });
        // 2 توابيت تحتوي على مقشة الساحرة
        for (let i = 0; i < 2; i++) allOutcomes.push({ text: 'مقشة الساحرة\nتحرر زميل لك', emoji: '💀🧹📤' });
        // 2 توابيت تحتوي على شبح مرعب
        for (let i = 0; i < 2; i++) allOutcomes.push({ text: 'شبح مرعب\nيقتلك', emoji: '👻' });
        // 2 توابيت تحتوي على سرب خفافيش
        for (let i = 0; i < 2; i++) allOutcomes.push({ text: 'سرب خفافيش\nيحبس زميل لك', emoji: '🦇🌕' });
      } else {
        // بيانات اللعبة لنسخة 20 تابوت
        names = [
          "صرخات الليل", "مقبرة الجن", "عذاب الارواح", "افعى القبور",
          "حطب جهنم", "عظام الجن", "زئير الهلاك", "صرير الكفن",
          "دم الخفافيش", "العنة الأبدية", "لعنة الحياة", "الافاعي المسكونة",
          "رأس الغراب", "صرخة الاموات", "نفس الجلاد", "همسة الجحيم",
          "ظلام الأبد", "لعنة الدم", "صرخة الأشباح", "عالم الظلام"
        ];
        
        // تعريف جميع النتائج الممكنة مع توزيعها للنسخة 20
        allOutcomes = [];
        // 7 توابيت فارغة
        for (let i = 0; i < 7; i++) allOutcomes.push({ text: 'تابوت فارغ\nاحبس عدوك', emoji: '⚰️📥' });
        // 3 توابيت ممتلئة
        for (let i = 0; i < 3; i++) allOutcomes.push({ text: 'تابوت ممتلئ\nواصل البحث', emoji: '🧱🧟' });
        // 4 توابيت تحتوي على مقشة الساحرة
        for (let i = 0; i < 4; i++) allOutcomes.push({ text: 'مقشة الساحرة\nتحرر زميل لك', emoji: '💀🧹📤' });
        // 3 توابيت تحتوي على شبح مرعب
        for (let i = 0; i < 3; i++) allOutcomes.push({ text: 'شبح مرعب\nيقتلك', emoji: '👻' });
        // 3 توابيت تحتوي على سرب خفافيش
        for (let i = 0; i < 3; i++) allOutcomes.push({ text: 'سرب خفافيش\nيحبس زميل لك', emoji: '🦇🌕' });
      }
      
      // تهيئة اللعبة بالبيانات المحددة
      initGame(names, allOutcomes);
      createFlyingBats();
      
      // إظهار زر نسخ التوابيت المتبقية
      document.getElementById('copyRemainingBtn').style.display = 'flex';
    }

    // دالة لخلط المصفوفة عشوائياً (Fisher-Yates shuffle)
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]]; // تبديل العناصر
        }
    }

    // متغيرات لتخزين التابوت الذي تم النقر عليه ونتيجته
    let lastClickedCoffinBtn = null;
    let lastClickedOutcome = null;
    
    // تهيئة الصفحة
    document.addEventListener('DOMContentLoaded', () => {
      // إضافة مستمعي الأحداث لأزرار المساعدة
      document.getElementById('showHelpBtn').addEventListener('click', showHelpModal);
      
      // إضافة مستمع حدث لزر نسخ التوابيت المتبقية
      document.getElementById('copyRemainingBtn').addEventListener('click', copyRemainingCoffins);
      
      // إغلاق المودال بالنقر على أي مكان في الخلفية
      document.getElementById('modal').addEventListener('click', (event) => {
          // تأكد من أن النقر كان على خلفية المودال وليس على محتواه الداخلي
          if (event.target.id === 'modal') {
              closeModal();
          }
      });
      // إضافة مستمع حدث لزر الإغلاق (X) داخل المودال
      document.querySelector('#modal .close-btn').addEventListener('click', closeModal);
    });
    
    // إنشاء شبكة التوابيت
    function initGame(names, allOutcomes) {
      // خلط النتائج
      shuffleArray(allOutcomes);
      
      const grid = document.getElementById('grid');
      grid.innerHTML = '';
      
      names.forEach((name, index) => {
        const coffinBtn = document.createElement('button');
        coffinBtn.className = 'coffin-button';
        coffinBtn.onclick = () => handleCoffinClick(coffinBtn);
        // تخزين النتيجة المخصصة لهذا التابوت في خاصية بيانات
        coffinBtn.dataset.outcomeEmoji = allOutcomes[index].emoji;
        coffinBtn.dataset.outcomeText = allOutcomes[index].text;
        // تخزين اسم التابوت ورقمه
        coffinBtn.dataset.coffinName = name;
        coffinBtn.dataset.coffinNumber = index + 1;
        
        coffinBtn.innerHTML = `
          <span class="coffin-text">
            تابوت<br>${name.split(' ').join('<br>')}<br>(${index + 1})
          </span>
          <svg class="coffin-lines" viewBox="0 0 140 280"
               xmlns="http://www.w3.org/2000/svg">
            <line x1="49" y1="0"   x2="53.2" y2="28"/>
            <line x1="91" y1="0"   x2="86.8" y2="28"/>
            <line x1="140" y1="56" x2="126"  y2="72.8"/>
            <line x1="126" y1="280"x2="114.8" y2="252"/>
            <line x1="14" y1="280" x2="25.2" y2="252"/>
            <line x1="0" y1="56"  x2="14"   y2="72.8"/>
          </svg>
        `;
        
        grid.appendChild(coffinBtn);
      });
    }
    
    // التعامل مع النقر على تابوت
    function handleCoffinClick(btn) {
      // التحقق مما إذا كان التابوت قد تم كشفه بالفعل
      const isRevealed = btn.classList.contains('coffin-revealed');
      
      const outcome = {
          emoji: btn.dataset.outcomeEmoji,
          text: btn.dataset.outcomeText
      };

      // تخزين التابوت الذي تم النقر عليه ونتيجته فقط إذا لم يكن مكشوفًا بعد
      if (!isRevealed) {
          lastClickedCoffinBtn = btn;
          lastClickedOutcome = outcome;
          btn.disabled = true; // تعطيل الزر مؤقتاً أثناء عرض المودال
      } else {
          // إذا كان مكشوفاً، لا نغير lastClickedCoffinBtn/Outcome
          // ولكن نضمن أن المودال سيُعرض بمحتواه الصحيح
      }

      showModal(outcome);
      
      // إضافة تأثير صوتي
      const audio = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAAAAAAA=');
      audio.volume = 0.3;
      audio.play();
    }
    
    // عرض التابوت المفتوح
    function showModal(outcome) {
      const modal = document.getElementById('modal');
      modal.querySelector('.coffin-msg').innerHTML = outcome.text;
      modal.querySelector('.coffin-emoji').innerHTML = outcome.emoji;
      
      modal.classList.add('active');
      
      // منع التمرير عند فتح المودال
      document.body.style.overflow = 'hidden';
    }
    
    // إغلاق التابوت المفتوح
    function closeModal() {
      const modal = document.getElementById('modal');
      modal.classList.remove('active');
      
      // إعادة التمرير
      document.body.style.overflow = '';

      // تحديث محتوى التابوت في الشبكة فقط إذا كان هناك تابوت تم النقر عليه لأول مرة
      if (lastClickedCoffinBtn && lastClickedOutcome) {
          // إزالة المحتوى الأصلي للتابوت (النص والخطوط)
          const coffinTextSpan = lastClickedCoffinBtn.querySelector('.coffin-text');
          const coffinLinesSvg = lastClickedCoffinBtn.querySelector('.coffin-lines');
          if (coffinTextSpan) coffinTextSpan.remove();
          if (coffinLinesSvg) coffinLinesSvg.remove();

          // إنشاء عناصر جديدة للمحتوى المكشوف
          const revealedContentDiv = document.createElement('div');
          revealedContentDiv.className = 'revealed-content';

          const revealedEmojiDiv = document.createElement('div');
          revealedEmojiDiv.className = 'revealed-emoji';
          revealedEmojiDiv.innerHTML = lastClickedOutcome.emoji;

          const revealedTextDiv = document.createElement('div');
          revealedTextDiv.className = 'revealed-text';
          // استبدال \n بـ <br> لعرض الأسطر الجديدة بشكل صحيح
          revealedTextDiv.innerHTML = lastClickedOutcome.text.replace(/\n/g, '<br>'); 

          revealedContentDiv.appendChild(revealedEmojiDiv);
          revealedContentDiv.appendChild(revealedTextDiv);

          lastClickedCoffinBtn.appendChild(revealedContentDiv);
          lastClickedCoffinBtn.classList.add('coffin-revealed'); // إضافة فئة لتمييز التابوت المكشوف
          
          lastClickedCoffinBtn.disabled = false; // إعادة تفعيل الزر ليصبح قابلاً للنقر مرة أخرى

          // إعادة تعيين المتغيرات استعدادًا للنقرة التالية
          lastClickedCoffinBtn = null;
          lastClickedOutcome = null;
      }
    }
    
    // عرض شاشة شرح اللعبة
    function showHelpModal() {
      const helpModal = document.getElementById('help-modal');
      helpModal.classList.add('active');
      document.body.style.overflow = 'hidden'; // منع التمرير
    }

    // إخفاء شاشة شرح اللعبة
    function hideHelpModal() {
      const helpModal = document.getElementById('help-modal');
      helpModal.classList.remove('active');
      document.body.style.overflow = ''; // إعادة التمرير
    }

    // إنشاء خفافيش طائرة للخلفية
    function createFlyingBats() {
      const bgElements = document.getElementById('bgElements');
      const batCount = 8;
      
      for (let i = 0; i < batCount; i++) {
        const bat = document.createElement('div');
        bat.className = 'bat';
        bat.innerHTML = '𖤍|𝐑𝐄𝐃𝐒𝐖𝐎𝐑𝐃🇦🇷🦇';
        bat.style.setProperty('--y', `${Math.random() * 100}vh`);
        bat.style.fontSize = `${Math.random() * 1 + 1}rem`;
        bat.style.animationDuration = `${Math.random() * 10 + 15}s`;
        bat.style.animationDelay = `${Math.random() * 5}s`;
        
        bgElements.appendChild(bat);
      }
    }
    
    // دالة نسخ التوابيت المتبقية
    function copyRemainingCoffins() {
      const remainingCoffins = [];
      const coffinButtons = document.querySelectorAll('.coffin-button');
      
      coffinButtons.forEach(button => {
        // التحقق مما إذا كان التابوت لم يتم فتحه بعد
        if (!button.classList.contains('coffin-revealed')) {
          const coffinName = button.dataset.coffinName;
          const coffinNumber = button.dataset.coffinNumber;
          remainingCoffins.push(`(${coffinNumber}) تابوت ${coffinName}`);
        }
      });
      
      // ترتيب التوابيت حسب رقمها
      remainingCoffins.sort((a, b) => {
        const numA = parseInt(a.match(/\((\d+)\)/)[1]);
        const numB = parseInt(b.match(/\((\d+)\)/)[1]);
        return numA - numB;
      });
      
      // إنشاء نص للنسخ
      const textToCopy = remainingCoffins.join('\n');
      
      // نسخ النص إلى الحافظة
      navigator.clipboard.writeText(textToCopy)
        .then(() => {
          // إظهار رسالة تأكيد
          const notification = document.getElementById('copy-notification');
          notification.classList.add('show');
          
          // إخفاء الرسالة بعد 3 ثوان
          setTimeout(() => {
            notification.classList.remove('show');
          }, 3000);
        })
        .catch(err => {
          console.error('فشل في نسخ النص: ', err);
        });
    }
  </script>
</body>
</html>
